<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام تسجيل الحضور بالـ QR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        /* تخصيص خط Inter (اختياري) */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            /* font-family: 'Cairo', sans-serif; */
        }
        /* إخفاء العناصر مبدئيًا */
        #attendanceFormSection, #successMessage, #errorMessage {
            display: none;
        }
        /* توسيط محتوى الـ QR */
        #qrcode {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }
        #qrcode img {
             border-radius: 0.5rem;
             border: 1px solid #e5e7eb;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-md text-center">

        <div id="qrSection">
            <h1 class="text-2xl font-bold mb-4 text-gray-800">تسجيل الحضور</h1>
            <p class="text-gray-600 mb-4">امسح رمز الـ QR التالي للانتقال إلى نموذج تسجيل الحضور.</p>
            <div id="qrcode" class="w-64 h-64 mx-auto"></div>
            <p id="qrError" class="text-red-500 mt-2" style="display: none;">حدث خطأ أثناء توليد رمز الـ QR.</p>
            <button id="scanButton" class="mt-6 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition duration-300">
                الانتقال إلى النموذج (محاكاة)
            </button>
        </div>

        <div id="attendanceFormSection">
            <h2 class="text-xl font-semibold mb-6 text-gray-800">إدخال البيانات</h2>
            <form id="attendanceForm">
                <div class="mb-4 text-right">
                    <label for="studentName" class="block text-gray-700 text-sm font-bold mb-2">الاسم:</label>
                    <input type="text" id="studentName" name="studentName" required
                           class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div class="mb-6 text-right">
                    <label for="studentId" class="block text-gray-700 text-sm font-bold mb-2">الكود الخاص بك:</label>
                    <input type="text" id="studentId" name="studentId" required
                           class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div class="flex items-center justify-center">
                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg transition duration-300">
                        تسجيل الحضور
                    </button>
                </div>
            </form>
        </div>

        <div id="successMessage" class="mt-6 p-4 bg-green-100 text-green-800 rounded-lg">
            تم تسجيل حضورك بنجاح! (محاكاة)
        </div>
         <div id="errorMessage" class="mt-6 p-4 bg-red-100 text-red-800 rounded-lg">
             حدث خطأ ما. يرجى المحاولة مرة أخرى.
        </div>

    </div>

    <script>
        // Define elements in the global scope
        const qrCodeElement = document.getElementById('qrcode');
        const qrSection = document.getElementById('qrSection');
        const attendanceFormSection = document.getElementById('attendanceFormSection');
        const attendanceForm = document.getElementById('attendanceForm');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        const qrErrorMessage = document.getElementById('qrError');
        const scanButton = document.getElementById('scanButton');

        let qrCodeInstance = null;

        // --- الرابط الفعلي لصفحتك على GitHub Pages ---
        const attendancePageUrl = 'https://diaaashraf2004.github.io/drashraf/scan.html#showForm';

        // Function to generate the QR code using the static URL
        function generateQRCode() {
            try {
                const qrData = attendancePageUrl;
                qrCodeElement.innerHTML = ''; // Clear previous QR code
                qrErrorMessage.style.display = 'none';

                qrCodeInstance = new QRCode(qrCodeElement, {
                    text: qrData,
                    width: 256,
                    height: 256,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
                console.log("QR Code Generated with URL:", qrData);

            } catch (error) {
                console.error("Error generating QR Code:", error);
                qrErrorMessage.style.display = 'block';
            }
        }

        // Function to switch view to the attendance form
        function showAttendanceForm() {
            console.log('Attempting to show attendance form...'); // تسجيل إضافي
            qrSection.style.display = 'none';
            attendanceFormSection.style.display = 'block';
            successMessage.style.display = 'none';
            errorMessage.style.display = 'none';
            console.log('Switched to attendance form view.');
        }

        // Form submission handler (remains the same)
        function handleFormSubmit(event) {
            event.preventDefault();
            console.log('Attendance form submit event triggered.');
            try {
                const studentName = document.getElementById('studentName').value;
                const studentId = document.getElementById('studentId').value;
                if (!studentName || !studentId) {
                    console.error('Validation failed: Name or ID is empty.');
                    errorMessage.textContent = 'يرجى إدخال الاسم والكود.';
                    errorMessage.style.display = 'block';
                    successMessage.style.display = 'none';
                    return;
                }
                console.log("--- محاكاة إرسال بيانات الحضور ---");
                console.log("الاسم:", studentName);
                console.log("الكود:", studentId);
                console.log("---------------------------------");
                attendanceFormSection.style.display = 'none';
                successMessage.style.display = 'block';
                errorMessage.style.display = 'none';
                console.log('Success message should be displayed now.');
            } catch (error) {
                console.error("Error during form submission:", error);
                errorMessage.textContent = 'حدث خطأ غير متوقع أثناء تسجيل الحضور.';
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
                attendanceFormSection.style.display = 'block';
            }
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
             console.log('DOM fully loaded and parsed.');

             // Check if critical elements exist
             if (!scanButton || !attendanceForm || !qrCodeElement || !qrSection || !attendanceFormSection) {
                 console.error('One or more essential elements not found!');
                 const body = document.querySelector('body');
                 if (body) {
                     body.innerHTML = '<p class="text-red-600 text-center p-8">حدث خطأ حرج في تحميل الصفحة. العناصر الأساسية مفقودة.</p>';
                 }
                 return; // Stop execution if elements are missing
             }

             // Attach event listeners
             scanButton.addEventListener('click', showAttendanceForm);
             console.log('Scan button event listener attached.');

             attendanceForm.addEventListener('submit', handleFormSubmit);
             console.log('Attendance form submit event listener attached.');

             // --- التحقق من الرابط عند التحميل ---
             const currentHash = window.location.hash;
             console.log('Current window.location.hash:', currentHash); // تسجيل قيمة الـ hash الحالية

             if (currentHash === '#showForm') {
                 console.log('URL hash #showForm detected. Calling showAttendanceForm().');
                 showAttendanceForm(); // Show the form directly if hash is present
             } else {
                 console.log('URL hash #showForm not detected or different. Generating QR code.');
                 // Generate the QR code only if not showing the form immediately
                 generateQRCode();
             }
             console.log('Initialization complete.'); // تسجيل إضافي
        });

    </script>

</body>
</html>

